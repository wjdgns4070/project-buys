<!-- views/index.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>음식 주문 페이지</title>

    <style>
        body {
            margin-left: 200px;
            margin-top: 0;
            /* 상단 여백을 0으로 설정 */

            background-image: url('images/back.jpg');
            /* 이미지 파일 경로로 수정 */
            background-size: cover;
            /* 이미지를 화면에 꽉 채우도록 설정 */
            background-position: center;
            /* 이미지를 가운데 정렬 */
            background-repeat: no-repeat;
            /* 이미지 반복 없음 */


        }

        /* 기존 스타일 */
        .main-menu,
        .side-menu,
        .drink {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            list-style: none;
            margin-bottom: 20px;
            padding: 0;
        }

        .menu-image-container {
            box-sizing: border-box;
            width: calc(33.33% - 20px);
            margin: 10px;
            position: relative;
            background-color: #fff;
        }

        .menu-image {
            width: 100%;
            height: 200px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .menu-button {
            width: 100%;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 16px;
            background-color: #fbfbe7;
            /* 장바구니 추가 버튼 배경색 */
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            z-index: 1;
        }

        .sidebar {
            height: 100vh;
            /* 뷰포트 높이로 설정 */
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            width: 200px;
            background-color: #f8f9fa;
            transition: background-color 0.3s ease;
            z-index: 1000;
            margin-top: 0;
            /* 상단 여백을 0으로 설정 */
        }

        .sidebar-section {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }

        .sidebar-section.active {
            background-color: #fff;
        }

        .cart-button:hover {
            background-color: #45a049;

        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.9);
            padding-top: 60px;
        }

        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 1138px;
            /* 조정된 너비 */
            max-height: 712px;
            /* 조정된 높이 */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .modal-image {
            width: 100%;
            height: auto;
        }

        .modal-description {
            color: #fff;
            text-align: center;
            padding: 10px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <!-- 네비게이션 바 추가 -->
    <!-- <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">J-order</a>
        </div>
    </nav> -->
    <div class="sidebar" id="sidebar">
        <!-- 각 섹션에 해당하는 클래스를 추가하고, data-target 속성을 이용하여 연결합니다. -->
        <div class="sidebar-section">J-order</div>
        <div class="sidebar-section" data-target="main-menu">메인 메뉴</div>
        <div class="sidebar-section" data-target="side-menu">사이드 메뉴</div>
        <div class="sidebar-section" data-target="drink">음료</div>
        <div class="mycoin">총금액: <span id="mycoinAmount">0</span>개</div>
        <button class="gamestart"  >게임하기</button>


    </div>

    <form id="menu-form" action="/addToCart" method="post">
        <h1>
            <div class="main-div">메인 메뉴</div>
        </h1>
        <ul id="menu-list" class="main-menu">
            <!-- 이미지와 버튼 추가 -->
            <li class="menu-image-container">
                <img src="/images/pappe.jpg" alt="페퍼로니 피자" class="menu-image" data-item="페퍼로니 피자" data-id="1"
                    data-price="12000원" data-etc="페퍼로니 피자입니다&lt;br&gt;추가 설명 줄 1&lt;br&gt;추가 설명 줄 2">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>

            <li class="menu-image-container">
                <img src="/images/hwai.jpg" alt="하와이안 피자" class="menu-image" data-item="하와이안 피자" data-id="2"
                    data-price="17000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/bulgogi.jpg" alt="불고기 피자" class="menu-image" data-item="불고기 피자" data-id="3"
                    data-price="15000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/saewu.jpg" alt="통새우 피자" class="menu-image" data-item="통새우 피자" data-id="4"
                    data-price="17000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/cheese.jpg" alt="치즈 피자" class="menu-image" data-item="치즈 피자" data-id="5"
                    data-price="13000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/potato.jpg" alt="스윗포테이토 피자" class="menu-image" data-item="스윗포테이토 피자" data-id="6"
                    data-price="15000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
        </ul>

        <h1>
            <div class="side-div">사이드 메뉴</div>
        </h1>
        <ul class="side-menu">

            <li class="menu-image-container">
                <img src="/images/macspa.jpg" alt="맥앤치즈 스파게티" class="menu-image" data-item="맥앤치즈 스파게티 피자" data-id="7"
                    data-price="7000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/cheeseoven.jpg" alt="치즈오븐 스파게티" class="menu-image" data-item="치즈오븐 스파게티" data-id="8"
                    data-price="7000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/hotwing.jpg" alt="핫윙" class="menu-image" data-item="핫 윙 5개" data-id="9"
                    data-price="4000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/hotbong.jpg" alt="핫봉" class="menu-image" data-item="핫 봉 5개" data-id="10"
                    data-price="4000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/cheeseball.jpg" alt="치즈볼" class="menu-image" data-item="치즈볼 6개" data-id="11"
                    data-price="4000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/ovencheese.jpg" alt="오븐치즈감자" class="menu-image" data-item="오븐치즈감자" data-id="12"
                    data-price="6000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
        </ul>

        <h1>
            <div class="drink-div">음료</div>
        </h1>
        <ul class="drink">

            <li class="menu-image-container">
                <img src="/images/cozero.jpg" alt="코카콜라 제로" class="menu-image" data-item="코카콜라 제로" data-id="13"
                    data-price="3000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/sider.jpg" alt="사이다" class="menu-image" data-item="사이다" data-id="14"
                    data-price="3000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/cloudbeer.jpg" alt="클라우드 맥주" class="menu-image" data-item="클라우드 맥주" data-id="15"
                    data-price="5000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>

            <li class="menu-image-container">
                <img src="/images/asahi.jpg" alt="아사히 맥주" class="menu-image" data-item="아사히 맥주" data-id="16"
                    data-price="5000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/kgb.jpg" alt="kgb 맥주" class="menu-image" data-item="kgb 맥주" data-id="17"
                    data-price="5000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>
            <li class="menu-image-container">
                <img src="/images/cruser.jpg" alt="크루저 맥주" class="menu-image" data-item="크루저 맥주" data-id="18"
                    data-price="5000원">
                <button type="button" class="menu-button">장바구니에 추가</button>
            </li>

        </ul>
    </form>
    <br><br>
    <br><br>
    <br><br>
    <br><br>

    <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption" class="modal-description"></div>
    </div>

    
    <script src="/js.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script> 네비게이션 부트스트랩 -->

    <!-- 이 부분은 이미지를 눌렀을 때 팝업 창으로 나오는 코드입니다 -->

    <script>
        // 페이지 스크롤 이벤트를 감지하여 사이드 바의 배경 색을 변경하는 스크립트
        document.addEventListener('DOMContentLoaded', function () {
            var sidebar = document.getElementById('sidebar');
            var mainMenu = document.querySelector('.main-div');
            var sideMenu = document.querySelector('.side-div');
            var drink = document.querySelector('.drink-div');

            // 각 섹션의 위치 계산
            var mainMenuTop = mainMenu.offsetTop;
            var sideMenuTop = sideMenu.offsetTop;
            var drinkTop = drink.offsetTop;

            // 클릭 이벤트 추가
            var sidebarSections = document.querySelectorAll('.sidebar-section');
            sidebarSections.forEach(function (section) {
                section.addEventListener('click', function () {
                    var target = section.getAttribute('data-target');
                    var targetTop = 0;

                    // 클릭된 섹션에 따라 이동할 위치 결정
                    if (target === 'main-menu') {
                        targetTop = mainMenuTop;
                    } else if (target === 'side-menu') {
                        targetTop = sideMenuTop;
                    } else if (target === 'drink') {
                        targetTop = drinkTop;
                    }

                    // 스크롤 이동
                    window.scrollTo({
                        top: targetTop,
                        behavior: 'smooth'
                    });

                    // 선택된 섹션 표시
                    setActiveSection(target);
                });
            });

            // 페이지 스크롤 이벤트
            window.addEventListener('scroll', function () {
                var scrollPosition = window.scrollY;

                // 각 섹션 위치와 현재 스크롤 위치를 비교하여 선택된 섹션 표시
                if (scrollPosition >= mainMenuTop && scrollPosition < sideMenuTop) {
                    setActiveSection('main-menu');
                } else if (scrollPosition >= sideMenuTop && scrollPosition < drinkTop) {
                    setActiveSection('side-menu');
                } else if (scrollPosition >= drinkTop) {
                    setActiveSection('drink');
                } else {
                    setActiveSection(null);
                }
            });

            function setActiveSection(section) {
                // 선택된 섹션 표시
                var sections = document.querySelectorAll('.sidebar-section');
                sections.forEach(function (item) {
                    item.classList.remove('active');
                });

                if (section) {
                    var activeSection = document.querySelector('.sidebar-section[data-target="' + section + '"]');
                    activeSection.classList.add('active');
                }
            }
        });
        // 이미지 클릭 시 모달 표시
        const menuImages = document.querySelectorAll('.menu-image');
        const modal = document.getElementById('mymodal');
        const modalImg = document.getElementById('img01');
        const modalCaption = document.getElementById('caption');

        menuImages.forEach(image => {
            image.addEventListener('click', function () {
                modal.style.display = 'block';
                modalImg.src = this.src;
                modalCaption.innerHTML = this.getAttribute('data-etc');
            });
        });

        // 모달 닫기 버튼 처리
        const closeBtn = document.querySelector('.close');
        closeBtn.addEventListener('click', function () {
            modal.style.display = 'none';
        });

        // 모달 외부 클릭 시 닫기
        window.addEventListener('click', function (event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // 클라이언트 측 코드
       // 클라이언트 측 코드
    

       let totalAmount = 0;

function showCart() {
    const cartCookie = document.cookie.split('; ')
        .find(cookie => cookie.startsWith('cart='));

    if (!cartCookie) {
        alert('장바구니가 비어 있습니다.');
        return;
    }

    const decodedCartValue = decodeURIComponent(cartCookie.split('=')[1]);
    const cartItems = JSON.parse(decodedCartValue);

    // 현재까지의 누적 총 금액 계산
    totalAmount = cartItems.reduce((sum, item) => sum + parseFloat(item.price), 0);

    // 모달 창에 장바구니 내역 표시
    const modal = document.getElementById('myModal');
    const modalContent = modal.querySelector('.modal-description');

    modalContent.innerHTML = `
        <h2>장바구니 내역</h2>
        ${cartItems.map(item => `
            <p>${item.name} - ₩${parseFloat(item.price)}원 
            <button type="button" class="delete-button" data-id="${item.id}">삭제</button></p>
            <hr>
        `).join('')}
        <p><strong>총 금액:</strong> ₩${totalAmount}원</p>
    `;

    // 모달 창 열기
    modal.style.display = 'block';

    // "구매하기" 버튼 추가
    const purchaseButton = document.createElement('button');
    purchaseButton.textContent = '구매하기';
    purchaseButton.addEventListener('click', function() {
        // 구매 처리
        purchaseItems();
    });
    modalContent.appendChild(purchaseButton);

    // "삭제" 버튼에 이벤트 리스너 추가
    const deleteButtons = modalContent.querySelectorAll('.delete-button');
    deleteButtons.forEach(button => {
        button.addEventListener('click', function () {
            const itemId = this.getAttribute('data-id');
            deleteItem(itemId);
        });
    });
}

// "구매하기" 버튼을 눌렀을 때 실행되는 함수
function purchaseItems() {
    const cartCookie = document.cookie.split('; ')
        .find(cookie => cookie.startsWith('cart='));

    if (!cartCookie) {
        alert('장바구니가 비어 있습니다.');
        return;
    }

    const decodedCartValue = decodeURIComponent(cartCookie.split('=')[1]);
    const cartItems = JSON.parse(decodedCartValue);

    axios.post('/purchase', cartItems)
        .then(response => {
            console.log('Purchase successful:', response.data);

            // 구매가 완료되면 쿠키 초기화
            document.cookie = 'cart=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/';

            // mycoin 갱신
            const mycoinAmountElement = document.getElementById('mycoinAmount');
            const currentMycoin = parseFloat(mycoinAmountElement.textContent);

            // 현재까지의 누적 총 금액 계산
            const totalAmount = cartItems.reduce((sum, item) => sum + parseFloat(item.price), 0);

            // 새로운 합계 금액을 현재 mycoin 값에 더하고 mycoin 엘리먼트 업데이트
            const updatedMycoin = currentMycoin + totalAmount / 1000;
                mycoinAmountElement.textContent = updatedMycoin.toFixed(0);

                  // mycoin 값을 쿠키에 저장
                  document.cookie = `mycoin=${updatedMycoin}; path=/`; // 변경된 부분

            // 팝업 창 닫기
            const modal = document.getElementById('myModal');
            modal.style.display = 'none';
        })
        .catch(error => {
            console.error('Purchase error:', error);
            alert('구매 중 오류가 발생했습니다.');
        });
}
// ...
        function deleteItem(itemId) {
            const cartCookie = document.cookie.split('; ')
                .find(cookie => cookie.startsWith('cart='));

            if (!cartCookie) {
                alert('장바구니가 비어 있습니다.');
                return;
            }

            const decodedCartValue = decodeURIComponent(cartCookie.split('=')[1]);
            let cartItems = JSON.parse(decodedCartValue);

            // 선택한 아이템 삭제
            cartItems = cartItems.filter(item => item.id !== itemId);

            // 새로운 장바구니 정보를 쿠키에 저장
            document.cookie = `cart=${encodeURIComponent(JSON.stringify(cartItems))}; path=/`;

            // 모달 창 갱신
            showCart();
        }
         // 게임하기 버튼 클릭 시 블랙잭 게임 페이지로 이동하는 함수
        // 게임하기 버튼 클릭 시 블랙잭 게임 페이지로 이동하는 함수
document.querySelector('.gamestart').addEventListener('click', function() {
    window.location.href = '/black_jack'; // 블랙잭 게임 페이지로 이동
});

    
    </script>

</body>

</html>